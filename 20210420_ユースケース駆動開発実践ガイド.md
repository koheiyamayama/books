# 本書のサマリ

# 詳細

## 1 章 ICONIX プロセス

- ICONIX プロセスはユースケースとコードの間に存在する領域にフォーカスした最小限かつ効率的なアプローチである。
- どんなプロジェクトでも要求を定義するところから始まる。
- 要求フェーズ
  - 機能要求: システムができることは何かを定義する。
  - ドメインモデリング: わかりやすい用語で問題領域を理解する。
  - 振る舞い要求: ユーザとシステムがどのように対話するのか定義する。GUI プロトタイプからはじめて実装対象となる全てのユースケースを識別するのが良い。最低限ユースケースの最初のリストを用意する。
  - 要求レビュー: ユースケース記述が顧客の要望に応えられているのか確認する。全てのユースケースが揃っている必要はない。ユースケース群が揃っていることは大事。
- 分析/予備レビュー
  - ロバストネス分析: ロバストネス図(ユースケースのステップに対する「オブジェクトの絵」)を描き、ユースケース記述を書き直す。
  - ユースケースとロバストネス図を書きつつ、ドメインモデルを更新する。
  - ユースケースを動かすために必要な全ての論理的なソフトウェア機能(コントローラ)に名前をつける。
  - 最初に書いたユースケース図を書き直す。
- 予備設計レビュー
- 詳細設計
  - シーケンス図の作成: ユースケースをどのように実装するかの詳細を示すためのシーケンス図を記述する。シーケンス図の役割はクラスに責務を割り当てることである。
  - シーケンス図を書きながらドメインモデルを更新し、ドメインオブジェクトに操作を追加する。この時点でドメインオブジェクトが静的なクラス図と転化する。
  - 静的モデルの整理をする。
- 詳細設計レビュー
- 実装
  - コーディングと単体テスト
  - 統合テストとシナリオテスト
  - コードレビューとモデルの更新

## 2 章 ドメインモデリング

- プロジェクトに関する生きた辞書。さらに単語間の関係性をグラフィカルに表されている。
- ユースケースから設計を導出する場合はドメインモデリングをしておいて、静的なモデルを作っておき、そこにユースケース図から得られた動的な振る舞いを紐付けることで、ドメインオブジェクトを導き出すことができる。要するにドメインモデリングでオブジェクトの静的な部分を、ユースケースでオブジェクトの動的な部分を洗い出すことができる。
- ドメインモデリングガイドラインのトップ 10
  1. ドメインモデルには、画面やその他の GUI 固有の部品クラスを含めてはならない。
     ドメインモデルは問題領域を抽象化したものなので、具体的な機能などは含めるべきではない。
  2. 最終的なクラス図がドメインモデルと正確に合致することを期待してはいけない。しかしこの 2 つは何らかの形で相似の関係にあるはず。
     クラス図はドメインモデルをより詳細したものとなる。なので、違ったものになるのは正しい。が、クラスとドメインモデルの関係性がどうなっているのかは導き出せる。
  3. 名前が曖昧になることを避けるため、ユースケースを書く前にドメインモデルを書け。
     ドメインモデルがない状態でユースケースを書くと、ユースケースが曖昧な要求となり、設計に活きなくなる。
  4. ドメインモデルをプロジェクトの用語集として使え。
  5. オブジェクト(単一のインスタンスを表現する存在)とデータベースのテーブル(モノの集合を含む存在)とを混同してはならない。
  6. ドメインモデルをデータモデルと勘違いしない。
  7. 問題領域中の主要な概念を中心にクラスを構成する。
     現実世界よりもソフトウェアの要求の方が変わりやすい。なので、変わりにくい現実世界を頼りにモデリングするべき。
  8. 最初のドメインモデリングに掛ける時間は 2 時間とする。
     ユースケース駆動では、最初のドメインモデルは不完全であることを前提としている。
     不完全であるドメインモデルは後のロバストネス分析、ユースケース分析をすることでより良いものにできる。
     この時点では 8 割ぐらいの完成度まで持っていければ良い。
  9. オブジェクト同士の関係を表現するため汎化関係(is a)および集約関係(has a)を利用しなさい。
     95%のオブジェクトの関係性は集約と汎化で表すことができる。
  10. 現実世界(問題領域)のオブジェクトに焦点を合わせなさい。
      現実世界よりもソフトウェアの要求の方が変わりやすい。なので、変わりにくい現実世界を頼りにモデリングするべき。
- 要求からドメインモデルを導き出す。その際に「システム(何らかの主語)は~~~しなければならない」「システムは~~~してはならない」といった形式で要求をリスト化する。そこで名詞を導き出す。
- 導き出された名詞をリスト化し、同じ意味で使われる単語、ドメインモデルの範囲外の単語を消していく。

## 3 章 ユースケースモデリング

- ユースケースは「ユーザはこのシステムで何をしたいのか」「ユーザは何を得たいのか」といった基本的な疑問に答える助けとなる。
- 他の本とは違い、この本ではユースケースは「良いオブジェクト指向設計を行い、質の高いコードを素早く得るための最初のステップ」として扱う。
- ユースケースでは正常系と異常系のケースを書く。
- ユースケースはドメインモデルの記述で用いた単語を使って書かれる。
- ドメインモデルはユースケース分析を行いながら、反復的に更新する。他にもロバストネス分析しながら、色々しながら更新する。
- ユースケースモデリングガイドライントップ 10→ オブジェクトモデルの単語を使ってシステムの使い方を記述する
  1. バウンダリクラスの名前を使う
  2. ドメインクラスの名前を使う
  3. 「名詞 - 名詞 - 動詞」という文の構造に従ってユースケースを書く
     名詞はオブジェクトのインスタンス。
  4. オブジェクトモデルの言葉を使ってユースケースを書く
     動詞はオブジェクト間のメッセージ。
     ユースケースとオブジェクトを結びつけることで、ユースケース駆動のオブジェクト指向設計ができる
  5. ユースケースは実行時の振る舞いの仕様であるということを忘れないように
  6. GUI プロトタイプや画面モックアップを使う
     あくまでイベントとその応答に着目する
  7. イベントとその応答の流れとしてユースケースを書き、ユーザとシステムの対話の両側を記述する
     「システムは~~~画面を表示する」からユースケースを書き始める。
     ユースケースは「ユーザとシステムとの対話」が記述されている。
     ユーザからの操作に応じて、システムがどう振る舞うのか規定するための図である。
  8. ユースケースは叙述的に書く
     「ユーザはパスワードを使った認証方式でログインできる」よりも「ユーザはユーザ名とパスワードを入力して、『ログイン』ボタンをクリックする。システムはユーザ名からユーザの情報を取り出し、パスワードをチェックする。そして、ユーザはシステムにログインする。」が好ましい。
  9. アクターとユースケース図を使ってユースケースを組織化する
  10. 2 段落ルールに従う

## 4 章 要求レビュー

1. レビューを「より良いユースケースのために 8 つの簡単なステップ」に沿って構成しなさい。
   a. スコープ外のもの全てを取り除く。
   b. 指示的な記述を叙述的に変える。
   c. ユースケース記述が抽象的すぎないことを確認する。
   d. GUI を正確にイメージする。
   e. 関係するドメインオブジェクトに名前をつける。
   f. すべての代替コースが存在することを確認する。
   g. ユースケースからすべての要求を追跡する。
   h. ユーザの望むことが個々のユースケースに記述されているかどうかを確認する。
2. ユースケース、ドメインモデル、画面モックアップ/GUI プロトタイプを、エンドユーザ、ステークホルダー、販売担当者、技術担当メンバーと一緒にレビューしなさい。
   a. とにかく関係者の共通の理解を得ることでメリットのないケースは見たことがない(筆者談)
3. ユースケース記述には GUI 紙芝居、線図、画面モックアップあるいは GUI プロトタイプを付随させる。
   a. モックアップがないことで、ユースケースに含めるべき表現を逃すかもしれない。
4. ユースケースはユーザーインターフェイスの用語で記述する。
   a. 画面に名前をつける。つけた名前をユースケース内で使うべき。
5. ユースケースはオブジェクトモデルの用語で記述する。
   a. ドメインモデルを作ってからユースケースを洗い出している。ユースケースで使う単語はドメインモデルから引用するべき。
6. ユースケースをパッケージによって組織化する。
   a. ユースケースモデルは機能的に関連した領域やリリース、あるいはその両方によって組織化できる。
   b. ユースケース図を完全にする必要はない。ユースケース駆動開発の中で重要なのは、ユースケース記述、ユースケースに対応するロバストネス図とシーケンス図である。
7. 機能要求をユースケース記述中に紛れ込ませていけません。
   a. 機能要求とはシステムが実現するべきこと。これはユースケースとして記述される必要がある。
8. 基本コースと代替コースの双方を叙述的に記述する。
9. 汎化関係や集約関係を示す。
10. ドメインモデルが問題領域をカバーしていることを確認する。
    a. ドメインモデルには問題領域中の最も重要な抽象概念を含める。
    b. ドメインモデルの中のすｂ手の箱にはシステムのユーザにもわかるような明確な名前をつける。
    c. 図を短時間で作成する。

## 5 章 ロバストネス分析

- ロバストネス図はユースケースとオブジェクトの関連付ける目的がある。ここで推定されるオブジェクト群はバウンダリオブジェクト、エンティティオブジェクト、コントローラに分類される。
- ロバストネス分析を通すことでユースケース記述から詳細設計をできるようにする。
  - バウンダリオブジェクト
    システムと外部世界とのインターフェイス。バウンダリオブジェクトは通常画面か Web ページとなる(プレゼンテーション層)。
  - エンティティオブジェクト
    ドメインクラス上のクラス
  - コントローラ  
    バウンダリオブジェクトとエンティティオブジェクトの間の接着剤
- 分析と設計のギャップを埋めるための作業。
- ロバストネス分析ガイドライントップ 10
  1. ロバストネス図はユースケースの「オブジェクトの絵」であるということを忘れさせないでください。その目的はユースケース記述とオブジェクトモデルの両方を強制的に洗練させる。
  2. 一般的に、ロバストネス図上のバウンダリオブジェクトとエンティティクラスはシーケンス図上のオブジェクトインスタンスとなります。一方、コントローラはシーケンス図上のメッセージとなる。
  3. ロバストネス図はユースケースに対する予備的な概念設計を示している。文字通りの詳細設計ではない。
  4. 親のユースケースから起動されるのであれば、ユースケースをロバストネス図上にドラッグしても良い。
  5. ロバストネス図上の矢印の方向について気にしない。
     ロバストネス図の目的は「ユースケース記述から曖昧さを取り除く」「ドメインモデル内で見逃したオブジェクトの発見を助ける」こと。この目的に矢印は一切寄与しない。
  6. コントローラは本物のコントローラオブジェクトになることがあるかもしれない。これらは通常論理的なソフトウェア機能に過ぎない。
  7. 画面単位にバウンダリオブジェクトを作成し、明確な画面名をつける。
  8. ロバストネス図の作成中にも、ユースケース記述を書き直して明確にすることがある。
  9. ドメインモデルからエンティティクラスを取り出し、不足しているものがあれば追加する。
  10. ユースケース記述をロバストネス図に直接貼り付ける。
- ロバストネス図の規則は以下の通り。
  - アクターはバウンダリオブジェクトとしか関係を持てない
  - バウンダリオブジェクトとエンティティオブジェクトは互いに直接関係を持つことはできない。コントローラを通じてのみ関係を持つことができる。
  - エンティティは他のエンティティと直接を関係を持つことはできない。コントローラを通じてしか関係を持つことができない。
  - バウンダリオブジェクトは他のバウンダリオブジェクトと直接を関係を持つことはできない。コントローラを通じてのみ関係を持つことができる。

## 6 章 予備設計レビュー

- 予備設計レビューガイドラインのトップ 10
  1. より良い予備設計のための「6 つの簡単な手順」に従いなさい。
     a. 図がユースケース記述に合致しているかどうかを確認する。
     b. 図がロバストネス分析の規則に従っているかどうかを確認する。
     c. 図がユースケースの論理的な流れに注力しているかどうかを確認する。
     d. ユースケースの動作に必要となる全ての代替コースが図に示されているかどうかを確認する。
     e. 図が「デザインパターン狂」になっていないかどうかを調べる。
     f. 図が詳細設計に踏み込んでいないかどうかを確認する。
  2. ロバストネス図でシーケンス図上に表現するようなレベルの詳細を示そうとしていないことを確認しなさい。詳細設計にはまだ手をつけない。
     ロバストネス図はソフトウェアの設計ではなく、概念設計であることを忘れないように。つまり、クラスに対する振る舞いの割当に関する決定はロバストネス図の作成中に行うべきではない。
  3. ユースケースがオブジェクトモデルと GUI の用語で記述されていることを確認しなさい。
  4. 技術者以外と技術者の双方が確実にレビューに参加するようにしなさい。
     ユースケースが全ての人にわかるように記述されていなければならない。
  5. ロバストネス図の構文ルールを破っていないことを確認しなさい。
     名詞 - 動詞 - 名詞の繋がりが意識されているか、アクターはバウンダリクラスとのみ会話ができる、名詞 - 名詞で繋がっていないか、などが守られているか確認しなさい。
  6. 各ユースケースが確実にユーザとシステムの間の対話の両側をカバーするようにしなさい。
     ユーザとシステムのインタラクティブなやり取りをモデル化する必要がある。なので、片方しかモデル化されていない場合、それは間違いである。
  7. 代替コースが漏れていないか、そして見つけ出した全ての代替コースに対する振る舞いが記述されているか確認しなさい。
     代替コースがソフトウェアの複雑度の半分以上を占める。代替コースが漏れている場合、代替コースに含まれているクラスがごっそり抜け落ちることになる。
  8. エンティティクラスと画面の間でデータの流れを確実に追跡できるようにしなさい。
     画面上でユーザがエンティティクラスの属性を入力、閲覧することがある。それらの属性を全てクラス図に反映するべきである。
  9. ロバストネス図上のすべてのエンティティが更新後のドメインモデル上に確実に存在するようにしなさい。
     ロバストネス分析する上で発見したオブジェクトをドメインモデル、クラス図に加えなければならない。
  10. ユースケースごとにユースケース記述とロバストネス図が一致しているかどうかを蛍光ペンを使って確認しなさい。
      ユースケースとロバストネス図の対応をマークしていき、不整合がある場合はまだやるべきことがあるということになる。

## 7 章 テクニカルアーキテクチャ

- アーキテクトの仕事は単に要求が示す問題を解決するための正しいアーキテクチャを構築することだけではない。アーキテクトは明確かつ表現よ r 区豊かな形式でアーキテクチャを文書化し、そしてプロジェクトの全員が最新版を参照できるようにする必要がある。最終的に全てを 1 つにまとめてプロジェクトの完了までを見届けるのはアーキテクトの仕事である。
- テクニカルアーキテクチャのガイドラインのトップ 10
  1. アーキテクチャが正しいと信じる勇気、そしてプロジェクトの間を通じてアーキテクチャの決定を推進する強さを持ちなさい。
  2. 連携しなければならない外部システムについて調査しなさい。
  3. テスト容易性について考慮しなさい。
  4. 必要な答えが得られなければ、再度質問する。
  5. 困難な問題は関係者全員に提示しなさい。
  6. 国際化および地域化について考慮しなさい。
  7. スケーラビリティ、セキュリティ、可用性といった要素について考慮しなさい。
  8. 要求に基づいてアーキテクチャの目的を決定しなさい。
  9. アーキテクチャを構築する理由を理解しなさい。
  10. 機能、データ、システムに対する個々のアーキテクチャを分離しなさい。
      a. 配備モデル(ネットワーク、アプリケーションサーバ、そしてそれらがどのように強調動作するのか)
      b. パッケージ/コンポーネントモデル(異なる層/コンポーネントへの関心事の分離)
      c. データモデル

## 8 章シーケンス図

- 予備設計ではクラス、オブジェクトの発見が目的だったが、詳細設計では振る舞いの割当を行うことを目的とする。
- すでにクラス、オブジェクトとソフトウェアの振る舞いは割り出されているので、この 2 つを紐付けていくことがここでの目的となる。
- シーケンス図作成ガイドラインのトップ 10
  1. 詳細設計レビューを行う前に、静的モデルを整理しなさい。
     シーケンス上でクラスに振る舞いを割り当てても、以下のことをやる必要があるかもしれない。
     a. 基盤クラスや足場クラスの利用
     b. デザインパターンの採用
     c. 設計をアプリケーションフレームワークに適合させる
     d. 操作の引数リストの完全化
     e. その他
  2. コーディングを始める前に、シーケンス図上に描かれた設計をプレリファクタリングしなさい。
  3. 全ての操作が正しいクラスに割り当てられるように操作の割当を行っている間はクラス図を繰り返しレビューしなさい。
  4. メッセージを描くことによって操作をクラスに割り当てなさい。
  5. 活性区間に対する検討に長い時間を費やしてはならない。
  6. ユースケース記述がシーケンス図上でやり取りされるメッセージと対応付けられるかどうかを確認しなさい。
  7. シーケンス図はユースケースの振る舞い(ロバストネス図上のコントローラのこと)をオブジェクトがどのように達成するかを示す道具として使いなさい。
  8. シーケンス図の作成はバウンダリクラス、エンティティクラス、アクター、そしてロバストネス分析の結果を反映したユースケース記述から始めなさい。
  9. 全てのユースケースに対して基本コースにと代替コースの両方のシーケンス図を同じ図上に記述しなさい。
     a. 今回のリリースで構築の対象とするユースケースの全てのシナリオを書く。
     b. クラスの操作を割り当てるべく、ユースケースごとにシーケンス図を作成する。
  10. 最大限の効果を得るために、なぜシーケンス図を描くのか理解しなさい。
      目的は以下の 3 つ。
      a. クラスに対する責務の割り当て
      ロバストネス図ではクラスを発見する。シーケンス図ではコントローラはクラスの操作へと変換される。コントローラと操作は一対一の関係とは限らない。しばしば 1 対多になりうる。時としてはコントローラがコントロールクラスに変換されることもある。
      b. ユースケースの生存期間中に各クラスが他のクラスとどのように相互作用するかの提示
      c. クラスに対する操作の割り当ての完了
- シーケンス図を作成する手順
  1. ユースケース記述をそのままシーケンス図に貼り付ける
  2. ロバストネス図からエンティティオブジェクトをコピーする
  3. ロバストネス図からバウンダリオブジェクトとアクターをコピーする
  4. クラスに操作を割り当てる
     オブジェクト指向の本を読み漁ると答えが出そう。

# 得られたこと

# メモ

- ユースケース → ロバストネス図によるソフトウェアの振る舞いの定義 → シーケンス図によるオブジェクトの定義
- 分析者の書いたユースケース図はプログラマから見ると、そこから実装に活かせるものが少ない。それを実装に活かせるようにするためにロバストネス図が役に立つ。
- ユースケース図からドメインモデルを導き出すのが本書で教えたいこと。
- 最小限のコアサブセットとユースケースからオブジェクト指向ソフトウェア設計を導出するための思考プロセス(このプロセスを ICONIX という)を説明している。

# 答えるべき問

- ユースケース駆動開発はどうして必要なのか？
- どういう問題に対処するのか？
- ユースケース記述が大事である理由は？
